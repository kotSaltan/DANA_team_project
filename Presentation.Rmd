---
title: "Report on Hotspots Data from Canada BC (2014-2023)"
author: "Team"
date: "2024-07-22"
output: 
  html_document:
    theme: flatly
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Loading Libraries and Reading Data

```{r libraries, include=FALSE}

# Load necessary libraries
library(readr) 
library(dplyr)
library(lubridate)
library(ggplot2)
library(dbscan) 
library(ggmap)
library(geosphere)
library(scales)
library(tidyr)
library(gridExtra)
library(corrplot)
library(openair)
library(GGally)
library(car)

```

```{r, read data}
# Set seed for reproducibility
set.seed(123)

# Register Stadia Maps API key
api_key <- "45381642-ef1c-4009-90a4-e54942f742c7"
register_stadiamaps(key = api_key)

# Get the name of working directory in RProject
proj.path <- getwd()

# Read the raw hotspots data from the data folder in the RProject directory
hotspots_raw <- read_csv(file.path(proj.path, 'data', 'hotspots.csv'))

```

### Subset for period 2014-2023, add month and day columns

```{r dates}
# Convert rep_date to POSIXct format
hotspots_raw$rep_date <- as.POSIXct(hotspots_raw$rep_date, format = "%Y-%m-%d %H:%M:%S")

# Add year and month columns to the data
hotspots_raw$year <- year(hotspots_raw$rep_date)
hotspots_raw$month <- month(hotspots_raw$rep_date, label = TRUE, abbr = TRUE)

# Filter the data to include only records from 2014 to 2023
hotspots <- hotspots_raw %>%
  filter(year >= 2014 & year <= 2023)
```

### Visualizing and Focusing on Specific Time Periods

```{r}
# Summarize the number of fire events per year and month
# This helps us understand the distribution of fire events over time
fire_events_per_month <- hotspots %>%
  group_by(year, month) %>%
  summarise(n_events = n(), .groups = 'drop') 

```

```{r, echo=FALSE}
# Create a bar plot to visualize the number of fire events per month
ggplot(fire_events_per_month, aes(x = month, y = n_events)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "black") +
  labs(title = "Number of Fire Events per Month",
       x = "Month",
       y = "Number of Fire Events") +
  scale_y_continuous(labels = scales::comma) + 
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))
```

```{r, echo=FALSE}
# Reshape the data to a wide format for easier visualization and comparison
fire_events_wide <- fire_events_per_month %>%
  pivot_wider(names_from = month, values_from = n_events, values_fill = 0)
```

```{r}
# Print the wide format summary table to inspect the reshaped data
print(fire_events_wide)
```

```{r heatmap, echo=FALSE}
# Define the color palette for the heatmap
colors <- c("gray95", "gray80", "yellow", "orange", "darkred", "black")

# Define the values for the color breaks
values <- c(0, 500, 1000, 2000, 10000, 350000)

# Create a heatmap to visualize the number of fire events per month and year
ggplot(fire_events_per_month, aes(x = month, y = factor(year), fill = n_events)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colors = colors, values = rescale(values), labels = scales::comma) +
  labs(title = "Number of Fire Events per Month and Year",
       x = "Month",
       y = "Year",
       fill = "Number of Events") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

### Focus on the peak fire season from May to October.

### Filter the data to include only these months.

```{r}
hotspots_peak <- hotspots %>%
  filter(month(rep_date) %in% c(5, 6, 7, 8, 9, 10))
```

```{r, echo=FALSE}
# Summarize the number of fire events per year and month for the peak season
fire_events_per_month_subset <- hotspots_peak %>%
  group_by(year, month) %>%
  summarise(n_events = n(), .groups = 'drop')

# Reshape the data to a wide format for the peak season
fire_events_subset_wide <- fire_events_per_month_subset %>%
  pivot_wider(names_from = month, values_from = n_events, values_fill = 0)
```

```{r}
# Print the wide format summary table for the peak season
print(fire_events_subset_wide)
```

```{r heatmap_peak, echo=FALSE}
# Create a heatmap to visualize the number of fire events per month and year for the peak season
ggplot(fire_events_per_month_subset, aes(x = month, y = factor(year), fill = n_events)) +
  geom_tile(color = "white") +
  scale_fill_gradientn(colors = colors, values = rescale(values), labels = scales::comma) +
  labs(title = "Number of Fire Events per Month and Year (Peak)",
       x = "Month",
       y = "Year",
       fill = "Number of Events") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

### Clustering using DBSCAN

*Prepare the data for clustering (latitude, longitude, date)\
Convert latitude and longitude from degrees to kilometers (1 degree \~ 111 km)\
Calculate time in hours from the first recorded event\
Note: time_hours is a component in clustering\
to group together events occurring within a certain time frame (20 hours).*

```{r dbscan_data}
event_data <- hotspots_peak %>%
  select(lat, lon, rep_date) %>%
  mutate(
    lat_km = lat * 111,
    lon_km = lon * 111,
    time_hours = as.numeric(difftime(rep_date, min(rep_date), units = "hours")) 
  ) %>%
  select(lat_km, lon_km, time_hours)  # Reassign event_data to include only the necessary columns
```

```{r dbscan_itiration,  eval=FALSE, include=TRUE}
# Function to apply DBSCAN and count clusters
apply_dbscan <- function(data, eps_value, minPts_value) {
  db <- dbscan(data, eps = eps_value, minPts = minPts_value)  # Apply DBSCAN
  data$event_cluster <- db$cluster  # Add cluster labels
  num_clusters <- length(unique(data$event_cluster)) - 1  # Count clusters excluding noise (0)
  num_noise <- sum(data$event_cluster == 0)  # Count noise points
  cat("eps =", eps_value, ", minPts =", minPts_value, ": Number of clusters =", num_clusters, ", Number of noise points =", num_noise, "\n")
  return(num_clusters)
}

# Parameters for the loop
desired_clusters <- 16956  # Official number of fires
best_eps <- NA  # Placeholder for best eps value
best_minPts <- NA  # Placeholder for best minPts value
best_diff <- Inf  # Placeholder for the smallest difference

# Iterate over eps and minPts values to find the best match
for (eps_val in seq(5, 15, by = 1)) {  # Adjust range and step size as needed
  for (minPts_val in seq(1, 5, by = 1)) {  # Adjust range and step size as needed
    num_clusters <- apply_dbscan(event_data, eps_val, minPts_val)
    diff <- abs(num_clusters - desired_clusters)
    if (diff < best_diff) {  # Check if this is the best match so far
      best_eps <- eps_val
      best_minPts <- minPts_val
      best_diff <- diff
    }
  }
}

# Print out the best parameters found
cat("Best eps value:", best_eps, "\n")  # Best eps value: 12
cat("Best minPts value:", best_minPts, "\n")  # Best minPts value: 1
```

*The best parameters found mean that fire events within a 12 km radius\
are grouped into clusters,\
and even a single event can form a cluster\
if it occurs alone within that distance during the given time span.*

```{r}
# Apply DBSCAN with the best parameters found
best_eps <- 12
best_minPts <- 1
best_db <- dbscan(event_data, eps = best_eps, minPts = best_minPts)

# Add cluster labels to the original dataset
hotspots_peak$event_cluster <- best_db$cluster

# Filter out noise (cluster 0)
# Cluster 0 represents noise points, which are outliers that do not belong to any cluster.
hotspots_peak <- hotspots_peak %>%
  filter(event_cluster != 0)

# Number of clusters identified by DBSCAN
cat("Number of clusters identified by DBSCAN:", length(unique(hotspots_peak$event_cluster)), "\n")
```

```{r}
# Summary of clusters
cluster_summary <- hotspots_peak %>%
  group_by(event_cluster) %>%
  summarise(
    start_date = min(rep_date),  # Get the earliest date in the cluster
    end_date = max(rep_date),  # Get the latest date in the cluster
    num_events = n(),  # Count the number of events in the cluster
    latitude = mean(lat),  # Calculate the average latitude of events in the cluster
    longitude = mean(lon)  # Calculate the average longitude of events in the cluster
  )
```

```{r}
# Get the top 5 largest clusters from the cluster_summary
top_clusters <- cluster_summary %>%
  arrange(desc(num_events)) %>%
  slice_head(n = 5) 

# Print the top clusters
print(top_clusters)
```


### Visualize the clusters

```{r}
# Function to plot clusters on map
plot_clusters_on_map <- function(cluster_ids, data, zoom_level = 10) {
  # Filter data for the specific clusters
  cluster_data <- data %>% filter(event_cluster %in% cluster_ids)
  
  # Define the bounding box for the map based on the clusters' coordinates
  bbox <- c(left = min(cluster_data$lon) - 0.3, 
            bottom = min(cluster_data$lat) - 0.3, 
            right = max(cluster_data$lon) + 0.3, 
            top = max(cluster_data$lat) + 0.3)
  
  # Get the map from Stadia Maps API
  map <- get_stadiamap(bbox = bbox, zoom = zoom_level, maptype = "stamen_terrain")
  
  
  
  # Plot the clusters data on the map
  print(ggmap(map) +
          geom_point(data = cluster_data, aes(x = lon, y = lat, color = factor(event_cluster)), size = 2, alpha = 0.3, shape = 16) +  
          labs(title = "Matched Fire Clusters", 
               x = "Longitude", 
               y = "Latitude", 
               color = "Cluster ID") +
          theme_minimal() +
          theme(legend.position = "bottom") +
          scale_color_manual(values = c("firebrick1", "orange", "yellow", "orange3", "darkred")) # Custom colours
  ) 
}
```

*ID 4792 Tweedsmuir Complex Fire (2018)*

*ID 3120 Elephant Hill Fire (2017)*

*ID 14487 Fort Nelson Fire (2023)*

*ID 4790 Shovel Lake Fire (2018)*

*ID 3125 Hanceville-Riske Creek Fire (2017)*


```{r, fig.width=10, fig.height=11, echo=FALSE}
# The biggest 5 clusters on the map
chosen_ids_top <- c(4792,3120,14487,4790,3125)

plot_clusters_on_map(chosen_ids_top, hotspots_peak, zoom_level = 7)
```


*The plots show large areas affected by fires.\
Each fire cluster covers a big region, indicating major fire events.\
Fire events within clusters are closely packed, showing high fire activity.\
The fires follow the terrain, influenced by vegetation and topography.*

### Kelowna Fire Event Analysis

```{r}
# Known fire near Kelowna in 2023
kelowna_fire <- data.frame(
  fire_name = "McDougall Creek Fire",
  start_date = as.POSIXct("2023-08-16"),
  end_date = as.POSIXct("2023-08-30"),
  latitude = 49.8821,
  longitude = -119.4370
)
```

```{r}
# Calculate the distance from each cluster to Kelowna fire
cluster_summary <- cluster_summary %>%
  mutate(
    distance_to_kelowna_fire = distHaversine(
      matrix(c(longitude, latitude), ncol = 2),
      matrix(c(kelowna_fire$longitude, kelowna_fire$latitude), ncol = 2)
    ) / 1000  # Convert meters to kilometers
  )

# Filter clusters that are within 50 km and have suitable dates
kelowna_clusters <- cluster_summary %>%
  filter(
    distance_to_kelowna_fire < 50 &  # Check if within 50 km
      start_date <= kelowna_fire$end_date &  # Check if cluster starts before the known fire ends
      end_date >= kelowna_fire$start_date    # Check if cluster ends after the known fire starts
  )

# Print the matching clusters
print(kelowna_clusters)
```

```{r, fig.width=7, fig.height=11, echo=FALSE, warning=FALSE}
# Plot the matching clusters on the map
plot_clusters_on_map(kelowna_clusters$event_cluster, hotspots_peak, zoom_level = 10)
```

### Variables

*The dataset contains different variables\
that are important to analyze fire events in British Columbia.\
These variables can be broadly categorized into the following categories:\
Location, Time, Data Collection Methods, Weather Data, Fire Indices, Other.*

`lat`: Latitude of the fire event.\
`lon`: Longitude of the fire event.

```{r}
# Summary of Latitude and Longitude
lat_range <- range(hotspots$lat, na.rm = TRUE)
lon_range <- range(hotspots$lon, na.rm = TRUE)

# British Columbia coordinates:
# Latitude: Between 48.309789°N and 60.00065°N
# Longitude: Between -139.058200 °W and -114.05423°W

cat("Latitude Range:", lat_range, "\n")
cat("Longitude Range:", lon_range, "\n")
```

`rep_date`: The date and time when the fire event was reported.\
`month` and `year` are new variables added

### Full Dataset Analysis

```{r}
# Summary table describing each hotspots dataset by year
hotspots_df_summary <- hotspots %>%
  group_by(year) %>%
  summarise(
    start_date = min(rep_date),
    end_date = max(rep_date),
    hotspots_df_day_count = as.numeric(difftime(max(rep_date), min(rep_date), units = "days"))
  )

print(hotspots_df_summary)
```

```{r, echo=FALSE}
# Plotting the number of days reported per year
ggplot(hotspots_df_summary, aes(x = factor(year), y = hotspots_df_day_count)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Number of Days Reported per Year",
       x = "Year",
       y = "Number of Days") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

*This barplot shows, how many days each year had recorded fire events.\
It also shows that reporting period has grown over the years.*

### Peak Season Analysis

```{r}
# Summary table for the peak season (May to October) describing each hotspots dataset by year
hotspots_peak_df_summary <- hotspots_peak %>%
  group_by(year) %>%
  summarise(
    start_date = min(rep_date),
    end_date = max(rep_date),
    hotspots_peak_day_count = as.numeric(difftime(max(rep_date), min(rep_date), units = "days")),
    num_clusters = n_distinct(event_cluster)  # Number of clusters in the peak season for each year
  )

print(hotspots_peak_df_summary)
```

*The table shows the earliest and latest dates of fire event reporting,\
the total number of days with recorded fire events,\
and the number of unique fire clusters detected during the peak season for each year.*

```{r,echo=FALSE}
# Plotting the number of clusters per year
ggplot(hotspots_peak_df_summary, aes(x = factor(year), y = num_clusters)) +
  geom_bar(stat = "identity", fill = "darkorange") +
  labs(title = "Number of Clusters per Year (Peak Season)",
       x = "Year",
       y = "Number of Clusters") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

*The barplot shows the number of unique fire clusters\
detected each year during the peak fire season.\
This number fluctuates each year,\
with noticeable peaks in 2018, 2021, and 2023.*

### Data Collection Methods

*Different sources, satellites, and sensors are used for data collection.*

```{r}
# Summary and Visualization of Sources
source_summary <- hotspots %>% 
  group_by(source) %>% 
  summarise(num_events = n())

print(source_summary)
```

```{r, echo=FALSE}
ggplot(source_summary, aes(x = reorder(source, -num_events), y = num_events)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Number of Fire Events Reported by Each Source",
       x = "Source",
       y = "Number of Events") +
  theme_minimal() +
  scale_y_continuous(labels = comma) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Summary and Visualization of Satellites
satellite_summary <- hotspots %>% 
  group_by(satellite) %>% 
  summarise(num_events = n())

print(satellite_summary)
```

```{r, echo=FALSE}
ggplot(satellite_summary, aes(x = reorder(satellite, -num_events), y = num_events)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Number of Fire Events Reported by Each Satellite",
       x = "Satellite",
       y = "Number of Events") +
  theme_minimal() +
  scale_y_continuous(labels = comma) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
# Summary and Visualization of Sensors
sensor_summary <- hotspots %>% 
  group_by(sensor) %>% 
  summarise(num_events = n())

#Advanced Very High Resolution Radiometer (AVHRR) imagery, courtesy of the NOAA
#Moderate Resolution Imaging Spectroradiometer (MODIS) imagery, courtesy of the NASA
#Visible Infrared Imaging Radiometer Suite (VIIRS) imagery, courtesy of NASA LANCE FIRMS

print(sensor_summary)
```

```{r, echo=FALSE}
ggplot(sensor_summary, aes(x = reorder(sensor, -num_events), y = num_events)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Number of Fire Events Reported by Each Sensor",
       x = "Sensor",
       y = "Number of Events") +
  theme_minimal() +
  scale_y_continuous(labels = comma) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Example of a Specific Fire Event: Kelowna Fire Cluster (Cluster ID: 13928)

```{r}
# Filter the data for the specific cluster
event_data <- hotspots_peak %>%
  filter(event_cluster == 13928)

# Summarize the sources, satellites, and sensors used for this event
event_sources <- event_data %>%
  group_by(source) %>%
  summarise(num_events = n())

event_satellites <- event_data %>%
  group_by(satellite) %>%
  summarise(num_events = n())

event_sensors <- event_data %>%
  group_by(sensor) %>%
  summarise(num_events = n())

# Print summaries
print(event_sources)
print(event_satellites)
print(event_sensors)
```

*In the Kelowna fire cluster (ID: 13928),\
data came from various sources, satellites, and sensors.\
Most data were provided by NASA sources and the VIIRS-I sensor,\
mainly using the S-NPP satellite.\
The VIIRS-I sensor and S-NPP satellite are the most used\
both for this event and the overall data.*

### Weather Data Variables

*Weather conditions are critical factors in the spread of fires.*

`temp`: Temperature (°C)\
`rh`: Relative Humidity (%)\
`ws`: Wind Speed (km/h)\
`wd`: Wind Direction (degrees)\
`pcp`: Precipitation (mm)

```{r}
# Function to describe each numerical column 
describe_numerical <- function(df, cols) {
  summary_list <- list()
  
  for (col in cols) {
    summary_stats <- data.frame(
      Variable = col,
      Missing_Values = sum(is.na(df[[col]])),
      Min = round(min(df[[col]], na.rm = TRUE), 2),
      Median = round(median(df[[col]], na.rm = TRUE), 2),
      Mean = round(mean(df[[col]], na.rm = TRUE), 2),
      Max = round(max(df[[col]], na.rm = TRUE), 2)
    )
    summary_list[[col]] <- summary_stats
  }
  
  summary_table <- bind_rows(summary_list)
  return(summary_table)
}

# Summary of weather data variables
summary_hotspots <- describe_numerical(hotspots_peak, c('temp', 'rh', 'ws', 'wd', 'pcp'))
print(summary_hotspots)
```

```{r include=FALSE}
# Create a table with mean values for plots
monthly_avg <- hotspots_peak %>%
  group_by(year, month) %>%
  summarise(avg_temp = mean(temp, na.rm = TRUE),
            avg_rh = mean(rh, na.rm = TRUE),
            avg_ws = mean(ws, na.rm = TRUE),
            avg_pcp = mean(pcp, na.rm = TRUE),
            avg_ffmc = mean(ffmc, na.rm = TRUE),
            avg_dmc = mean(dmc, na.rm = TRUE),
            avg_dc = mean(dc, na.rm = TRUE),
            avg_isi = mean(isi, na.rm = TRUE),
            avg_bui = mean(bui, na.rm = TRUE),
            avg_fwi = mean(fwi, na.rm = TRUE),
            avg_sfc = mean(sfc, na.rm = TRUE),
            avg_tfc = mean(tfc, na.rm = TRUE),
            avg_bfc = mean(bfc, na.rm = TRUE),
            avg_hfi = mean(hfi, na.rm = TRUE),
            avg_ros = mean(ros, na.rm = TRUE),
            .groups = 'drop') 
```

*There are no missing values in the weather data.\
The minimum temperature recorded is -9.66°C, which is unusually low for fire events.\
The maximum temperature recorded is 43.88°C, which is expected during peak fire seasons.\
The relative humidity ranges from 7.00% to 100.00%, there are different weather conditions.\
Wind speeds range from 0.00 km/h to 16.47 km/h.\
There is a full range of possible wind directions.\
The precipitation data has a maximum value of 651.79 mm, needs further investigation.*

```{r}
# Summarize the count of subzero temperature events by year and month
subzero_temps_summary <- hotspots_peak %>%
  filter(temp < 0) %>%
  group_by(year, month) %>%
  summarise(count = n(), .groups = 'drop') %>%
  arrange(desc(year))

# Print the summary table
print(subzero_temps_summary)
```

*The peak month for subzero temperature events is October,\
even colder conditions do not stop fires from happening.*

```{r}
# Summarize the count of precipitation events > 100 mm by year and month
high_pcp_summary <- hotspots_peak %>%
  filter(pcp > 100) %>%
  group_by(year, month, event_cluster) %>%
  summarise(count = n(), .groups = 'drop') %>%
  arrange(desc(year))

# Print the summary table
print(high_pcp_summary)
```

```{r, fig.width=7, fig.height=11, echo=FALSE}
# Plot the event on map
plot_clusters_on_map(14510, hotspots_peak, zoom_level = 10)
```

```{r}
# Remove the high precipitation outlier from the dataset
hotspots_peak <- hotspots_peak %>%
  filter(!(event_cluster == 14510 & year == 2023 & month == "Jul"))

# Re-run the descriptive statistics without the outlier
summary_hotspots <- describe_numerical(hotspots_peak, c('temp', 'rh', 'ws', 'wd', 'pcp'))
print(summary_hotspots)
```

### Temperature (°C)

```{r, echo=FALSE}
# Create a boxplot to compare temperature distributions across years
ggplot(hotspots_peak, aes(x = factor(year), y = temp)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Temperature Distribution Across Years (Peak)",
       x = "Year",
       y = "Temperature (°C)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))

```

*The median temperatures are between 20°C and 25°C.\
2019 stands out with a slightly lower median temperature.\
There are significant outliers present in all years,\
particularly in 2014, 2017, 2018, and 2023.*

```{r, echo=FALSE}
# Lineplot for temperature over time
ggplot(monthly_avg, aes(x = month, y = avg_temp, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "Temperature by Month",
       x = "Month",
       y = "Temperature (°C)",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*There is a clear seasonal pattern,\
temperatures peak around July and August, then decrease towards October.\
Some years, like 2014 and 2021, show higher peaks, meaning hotter summer months.*

### Relative Humidity (%)

```{r, echo=FALSE}
# Create a boxplot to compare relative humidity distributions across years
ggplot(hotspots_peak, aes(x = factor(year), y = rh)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Relative Humidity Distribution Across Years (Peak)",
       x = "Year",
       y = "Relative Humidity") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

*Median relative humidity falls between 30% and 40%.\
In 2019, median values are higher, indicating more humid season.\
All years have significant outliers, especially 2014, 2017, and 2021, showing extremely humid days.*

```{r, echo=FALSE}
# Lineplot for relative humidity over time
ggplot(monthly_avg, aes(x = month, y = avg_rh, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "Relative Humidity by Month",
       x = "Month",
       y = "Relative Humidity",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*Humidity values typically increase from August to October.\
Notable peaks in summer are seen in 2016, 2019 and 2020.*

### Wind Speed (km/h)

```{r, echo=FALSE}
# Create a boxplot to compare wind speed distributions across years
ggplot(hotspots_peak, aes(x = factor(year), y = ws)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Wind Speed Distribution Across Years (Peak)",
       x = "Year",
       y = "Wind Speed (km/h)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

*The median wind speeds generally fall between 7 and 9 km/h.\
There are significant outliers in all years, particularly noticeable in 2014, 2015, and 2018,\
there were days with extremely high wind speeds.*

```{r, echo=FALSE}
# Lineplot for wind speed over time
ggplot(monthly_avg, aes(x = month, y = avg_ws, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "Wind Speed by Month",
       x = "Month",
       y = "Wind Speed (km/h)",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*There is a clear seasonal pattern where wind speeds tend to be higher in the summer months and decrease towards October.\
Some years, like 2015 and 2020, show more pronounced peaks in wind speed.\
The overall trend remains consistent with seasonal variations.*

### Wind direction (degrees)

*Visualize with Wind Rose to see most common wind direction using converted wind speed.*

```{r}
# Convert wind speed from km/h to m/s
hotspots_peak <- hotspots_peak %>%
  mutate(ws_m_s = ws / 3.6)

windRose(mydata = hotspots_peak, ws = "ws_m_s", wd = "wd", 
         main = "Wind Rose", paddle = FALSE)
```

*Most of the wind comes from the west and southwest.\
Regions east and north of areas with strong western, southern, and southwestern winds\
should be careful, as these winds can quickly spread fires.*

### Precipitation (mm)

```{r, echo=FALSE}
# Create a boxplot to compare precipitation distributions across years
ggplot(hotspots_peak, aes(x = factor(year), y = pcp)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Precipitation Distribution Across Years (Peak)",
       x = "Year",
       y = "Precipitation (mm)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

*The median values for precipitation are consistently very low, often close to zero.\
Despite this, there are significant outliers in every year, particularly in 2017 and 2023.\
These outliers indicate that certain days had much higher than average rainfall.*

```{r, echo=FALSE}
# Lineplot for precipitation over time
ggplot(monthly_avg, aes(x = month, y = avg_pcp, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "Precipitation by Month",
       x = "Month",
       y = "Precipitation (mm)",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*There is a notable peak in July for several years,\
with some years, like 2018, 2019 and 2020,\
showing higher average precipitation during these months.*

### Outliers

*Even after removing one extreme outlier, there are still many high precipitation values.\
Since precipitation often has many zero entries,\
need to handle these outliers carefully to ensure they don't skew our results.*

```{r}
# Define the function to remove outliers
remove_outliers <- function(data, variable) {
  q1 <- quantile(data[[variable]], 0.25, na.rm = TRUE)
  q3 <- quantile(data[[variable]], 0.75, na.rm = TRUE)
  iqr <- q3 - q1
  lower_bound <- q1 - 1.5 * iqr
  upper_bound <- q3 + 1.5 * iqr
  data %>% filter(data[[variable]] >= lower_bound & data[[variable]] <= upper_bound)
}
```

```{r}
# Remove outliers for temperature, relative humidity, and wind speed
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("temp") %>%
  remove_outliers("rh") %>%
  remove_outliers("ws")

# Check the summary statistics after removing outliers
summary_clean <- describe_numerical(hotspots_peak_clean, c('temp', 'rh', 'ws', 'wd', 'pcp'))
print(summary_clean)
```

```{r, echo=FALSE}
# Create a box plot to compare temperature distributions across years
ggplot(hotspots_peak_clean, aes(x = factor(year), y = temp)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Temperature Distribution Across Years (Peak, Cleaned)",
       x = "Year",
       y = "Temperature (°C)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))


# Create a box plot to compare relative humidity distributions across years
ggplot(hotspots_peak_clean, aes(x = factor(year), y = rh)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Relative Humidity Distribution Across Years (Peak, Cleaned)",
       x = "Year",
       y = "Relative Humidity (%)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))


# Create a box plot to compare wind speed distributions across years
ggplot(hotspots_peak_clean, aes(x = factor(year), y = ws)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Wind Speed Distribution Across Years (Peak, Cleaned)",
       x = "Year",
       y = "Wind Speed (km/h)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))

```

*The boxplots now show a more consistent distribution of temperatures across different years.\
The majority of the years have median temperatures between 20°C and 25°C.\
The extreme outliers have been reduced, providing a clearer view of the central temperature tendencies.*

*The median RH values generally remain between 30% and 40% across the years.\
2019 still shows higher median RH, indicating more humid conditions.\
Significant outliers have been reduced, giving a better understanding of the general RH trends.*

*Median wind speeds for each year are now clearly visible, generally falling between 7 and 10 km/h.\
The removal of outliers helps to see typical wind speeds more accurately.\
The boxplots show that some years, like 2020 and 2021, still have a wider range of wind speeds.*

### Fire Indices

*These indices are derived from weather conditions and provide insights into fire behavior and potential risks.*

`ffmc`: Fine Fuel Moisture Code\
`dmc`: Duff Moisture Code\
`dc`: Drought Code\
`isi`: Initial Spread Index\
`bui`: Buildup Index\
`fwi`: Fire Weather Index

```{r}
# Summary of fire indices
summary_fire_indices <- describe_numerical(hotspots_peak, c('ffmc', 'dmc', 'dc', 'isi', 'bui', 'fwi'))
print(summary_fire_indices)
```

### FFMC

*A numeric rating of the moisture content of litter and other cured fine fuels.\
This code is an indicator of the relative ease of ignition and the flammability of fine fuel.*

*The FFMC scale ranges from 0 to 101.\
0-30: Very wet conditions; ignition is difficult.\
30-70: Damp conditions; moderate difficulty for ignition.\
70-85: Dry conditions; fuels are easily ignitable.\
85-101: Very dry conditions; fuels are highly ignitable and fires can spread rapidly.*

```{r, echo=FALSE}
# Plot histogram for FFMC
ggplot(hotspots_peak, aes(x = ffmc)) +
  geom_histogram(binwidth = 2, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of FFMC Values", x = "FFMC", y = "Frequency") +
  scale_y_continuous(labels = comma) + 
  theme_minimal()
```

```{r, echo=FALSE}
# Plot boxplot for FFMC
boxplot_ffmc <- ggplot(hotspots_peak, aes(x = factor(year), y = ffmc)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "FFMC Distribution Across Years",
       x = "Year",
       y = "FFMC") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
boxplot_ffmc
```

*The values in the dataset show that during the peak season, the FFMC values are generally high, with a median around 91.50 and a maximum of 99.00. This suggests that the fine fuels are often in a dry state, making them highly ignitable and prone to rapid fire spread.*

*Most years have high FFMC values above 90. Only 2019 and 2020 show slightly lower values.*

```{r, echo=FALSE}
# Line plot for FFMC over time
ggplot(monthly_avg, aes(x = month, y = avg_ffmc, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Dashed line for trend
  labs(title = "FFMC by Month",
       x = "Month",
       y = "FFMC",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*The lineplot shows that FFMC values peak every year during the fire season.*

### Remove outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("ffmc")

boxplot_ffmc_clean <- ggplot(hotspots_peak_clean, aes(x = factor(year), y = ffmc)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "FFMC Distribution Across Years (Clean)",
       x = "Year",
       y = "FFMC") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
grid.arrange(boxplot_ffmc, boxplot_ffmc_clean)
```

*After removing outliers, the boxplots for FFMC show a more consistent distribution across the years.\
The median values are mostly above 90.*

### Duff Moisture Code

*A numeric rating of the average moisture content\
of loosely compacted organic layers of moderate depth.\
This code gives an indication of fuel consumption in moderate duff layers\
and medium-size woody material.*

*It ranges typically from 0 to over 200, higher values indicate drier conditions and a higher fire risk.*

*0-20: Low fire danger, duff layers are wet, and ignition is unlikely. 21 - 40: Moderate fire danger, duff layers start drying. 41 - 100: High fire danger, the duff layer is dry, prone to ignition. 100 + : Extreme fire danger, the duff layer is very dry, and ignition is very likely with the potential for intense fires.*

```{r, echo=FALSE}
# Plot histogram for DMC
ggplot(hotspots_peak, aes(x = dmc)) +
  geom_histogram(binwidth = 2, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of DMC Values", x = "DMC", y = "Frequency") +
  scale_y_continuous(labels = comma) + 
  theme_minimal()

# Plot boxplot for DMC
boxplot_dmc <- ggplot(hotspots_peak, aes(x = factor(year), y = dmc)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "DMC Distribution Across Years",
       x = "Year",
       y = "DMC") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
boxplot_dmc
```

*The histogram shows that most DMC values range between 0 and 150, with a peak around 50-100.\
Values above 200 are less common but indicate long dry periods.*

*The boxplots for each year show that 2017 and 2018 had particularly high outliers,\
indicating extremely dry conditions.\
2019 had lower DMC values, showing less severe drought.*

```{r, echo=FALSE}
# Line plot for DMC over time
ggplot(monthly_avg, aes(x = month, y = avg_dmc, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Dashed line for trend
  labs(title = "DMC by Month",
       x = "Month",
       y = "DMC",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*The lineplot indicates that DMC values peak in late summer (August) and decrease in autumn.*

### Remove outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("dmc")

# Plot boxplot for DMC
boxplot_dmc_clean <- ggplot(hotspots_peak_clean, aes(x = factor(year), y = dmc)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "DMC Distribution Across Years (Clean)",
       x = "Year",
       y = "DMC") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
grid.arrange(boxplot_dmc, boxplot_dmc_clean)
```

*After removing the outliers, the DMC values became more consistent across different years.\
The median values now mostly fall between 50 and 100, providing a clearer picture of typical drought conditions.\
While 2017 and 2021 still show higher values, the extremes have been reduced.*

### Drought Code

*A numeric rating of the average moisture content of deep, compact organic layers.\
This code is a useful indicator of seasonal drought effects on forest fuels and the amount of smoldering\
in deep duff layers and large logs.*

*0-100: Indicates wet conditions with low fire potential.\
100-300: Moderate drought conditions with increasing fire potential.\
300-500: High drought conditions, leading to high fire risk.\
500+: Indicates extreme drought, posing a very high fire risk and potential for intense, prolonged burning.*

*DC is important because it helps understand how dry the forest floor is\
and the chance for deep-burning fires.\
Higher DC values usually mean longer dry periods and can show how severe fire seasons might be.*

```{r, echo=FALSE}
# Plot histogram for DC
ggplot(hotspots_peak, aes(x = dc)) +
  geom_histogram(binwidth = 20, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of DC Values", x = "DC", y = "Frequency") +
  scale_y_continuous(labels = comma) + 
  theme_minimal()

# Plot boxplot for DC
boxplot_dc <- ggplot(hotspots_peak, aes(x = factor(year), y = dc)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "DC Distribution Across Years",
       x = "Year",
       y = "DC") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
boxplot_dc
```

*The histogram of DC values from 2014 to 2023 shows most values are between 300 and 700, peaking around 500.*\
*This means BC often has conditions that can lead to deep-burning fires.*

*The boxplot of DC values across years show the variability and trends in drought conditions over time.\
2017 and 2023 have higher median values, meaning very dry conditions.\
2016 and 2019 show lower DC values, suggesting wetter conditions and potentially less severe fire activity.*

```{r, echo=FALSE}
# Line plot for DC over time
ggplot(monthly_avg, aes(x = month, y = avg_dc, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Dashed line for trend
  labs(title = "DC by Month",
       x = "Month",
       y = "DC",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*The line plot of DC values by month shows a clear seasonal trend,\
DC values increase during the summer months (July to September) and decrease in the autumn.\
This occurs at the time of the peak fire season.\
There are a lot of high DC values, more than 500, it shows conditions for deep-burning fires.*

### Remove outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("dc")

# Plot boxplot for DC
boxplot_dc_clean <- ggplot(hotspots_peak_clean, aes(x = factor(year), y = dc)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "DC Distribution Across Years (Clean)",
       x = "Year",
       y = "DC") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
grid.arrange(boxplot_dc,boxplot_dc_clean)
```

*The median DC values are more consistent, generally falling between 250 and 550.\
The range of the data has been reduced, with fewer extreme outliers.*

### Compare indices to the number of events

*Create a combined plot from monthly average indices and fire events per month tables\
to show the trends of the FFMC, DMC and DC and the number of fire occurrences over time.*

```{r}
# Merge the dataframes
monthly_data <- merge(monthly_avg, fire_events_per_month, by = c("year", "month"))

# Convert 'month' column from ordered factor to numeric
monthly_data$month <- as.numeric(monthly_data$month)

# Create the 'Date' column using 'year' and 'month'
monthly_data$Date <- as.Date(paste(monthly_data$year, monthly_data$month, "01", sep = "-"))

# Normalize the fire numbers data 
max_events <- max(monthly_data$n_events, na.rm = TRUE)

monthly_data <- monthly_data %>%
  mutate(norm_n_events = n_events / max_events)

# Maximum values for scaling
max_ffmc <- max(monthly_data$avg_ffmc, na.rm = TRUE)
max_dmc <- max(monthly_data$avg_dmc, na.rm = TRUE)
max_dc <- max(monthly_data$avg_dc, na.rm = TRUE)

```

```{r, echo=FALSE}
# Plot FFMC and Fire Counts
ggplot(monthly_data, aes(x = Date)) +
  geom_line(aes(y = avg_ffmc, color = "FFMC"), size = 1) +
  geom_bar(aes(y = norm_n_events * max_ffmc, fill = "Fire Occurrences"), stat = "identity", color = "black", alpha = 0.6) +
  scale_y_continuous(
    name = "FFMC",
    sec.axis = sec_axis(~ . * 1000 / max_ffmc * max(monthly_data$n_events) / 1000, 
                        name = "Number of Fire Occurrences", labels = comma)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = "Monthly Trends of FFMC and Fire Occurrences",
       x = "Year",
       color = "Index",
       fill = "Index") +
  scale_color_manual(values = c("FFMC" = "lightblue")) +
  scale_fill_manual(values = c("Fire Occurrences" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")

# Plot DMC and Fire Counts
ggplot(monthly_data, aes(x = Date)) +
  geom_line(aes(y = avg_dmc, color = "DMC"), size = 1) +
  geom_bar(aes(y = norm_n_events * max_dmc, fill = "Fire Occurrences"), stat = "identity", color = "black", alpha = 0.6) +
  scale_y_continuous(
    name = "DMC",
    sec.axis = sec_axis(~ . * 1000 / max_dmc * max(monthly_data$n_events) / 1000, 
                        name = "Number of Fire Occurrences", labels = comma)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = "Monthly Trends of DMC and Fire Occurrences",
       x = "Year",
       color = "Index",
       fill = "Index") +
  scale_color_manual(values = c("DMC" = "lightblue")) +
  scale_fill_manual(values = c("Fire Occurrences" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")

# Plot DC and Fire Counts
ggplot(monthly_data, aes(x = Date)) +
  geom_line(aes(y = avg_dc, color = "DC"), size = 1) +
  geom_bar(aes(y = norm_n_events * max_dc, fill = "Fire Occurrences"), stat = "identity", color = "black", alpha = 0.6) +
  scale_y_continuous(
    name = "DC",
    sec.axis = sec_axis(~ . * 1000 / max_dc * max(monthly_data$n_events) / 1000, 
                        name = "Number of Fire Occurrences", labels = comma)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = "Monthly Trends of DC and Fire Occurrences",
       x = "Year",
       color = "Index",
       fill = "Index") +
  scale_color_manual(values = c("DC" = "lightblue")) +
  scale_fill_manual(values = c("Fire Occurrences" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*The plots show a clear relationship between the fire indices (FFMC, DMC, and DC) and the number of fires.\
When the number of fires is high, the indices also show higher values.*

*It's important to note that while high indices indicate conditions favorable for fires,\
they alone do not cause fires.*

### Initial Spread Index

*A numerical rating of the expected rate of fire spread\
based on wind speed, temperature, and fine fuel moisture content.\
ISI is crucial for understanding how quickly a fire can spread once it has ignited.*

*0-3: Low spread potential. Fires will spread slowly and are relatively easy to control. 4-7: Moderate spread potential. Fires spread more quickly and may require more effort to control. 8-12: High spread potential. Fires spread rapidly and can be difficult to control. 13-19: Very high spread potential. Fires spread very rapidly and are challenging to control. 20+: Extreme spread potential. Fires spread uncontrollably and can be extremely dangerous.*

```{r, echo=FALSE}
# Plot histogram for ISI
ggplot(hotspots_peak, aes(x = isi)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of ISI Values", x = "ISI", y = "Frequency") +
  scale_y_continuous(labels = scales::comma) + 
  theme_minimal()

# Plot boxplot for ISI
boxplot_isi <- ggplot(hotspots_peak, aes(x = factor(year), y = isi)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "ISI Distribution Across Years",
       x = "Year",
       y = "ISI") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
boxplot_isi
```

*The boxplot shows variability in ISI values across years, with notable outliers in 2014.\
The histogram indicates that most ISI values are low to moderate.*

```{r, echo=FALSE}
# Line plot for ISI over time
ggplot(monthly_avg, aes(x = month, y = avg_isi, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "ISI by Month",
       x = "Month",
       y = "ISI",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*ISI values tend to peak during the summer months, indicating higher fire spread potential during this period.*

### Analyses of the extreme outliers of 2014, values greater than 40

```{r}
# Filter out entries with ISI values greater than 40
isi_outliers <- hotspots_peak %>%
  filter(isi >= 40)

# Check the number of outliers
dim(isi_outliers)
isi_outliers %>% 
  count(event_cluster) %>% 
  arrange(desc(n))
# Most isi outliers come from clusters 401 and 130
```

```{r, fig.width=7, fig.height=11, echo=FALSE}
plot_clusters_on_map(401, hotspots_peak, zoom_level = 10)
plot_clusters_on_map(130, hotspots_peak, zoom_level = 10)
```

*The data from July 2014, shows very high ISI values at a specific location in British Columbia.\
This matches the date of the Mount McAllister fire, a large wildfire that burned over 20,000 hectares.*

### Remove outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("isi")

# Plot boxplot for ISI
boxplot_isi_clean <- ggplot(hotspots_peak_clean, aes(x = factor(year), y = isi)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "ISI Distribution Across Years (Clean)",
       x = "Year",
       y = "ISI") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
grid.arrange(boxplot_isi,boxplot_isi_clean)
```

*The cleaned data shows a clearer view of typical ISI values.*

### Buildup Index

*A numerical rating of the total amount of fuel available for combustion.\
It is derived from the Duff Moisture Code (DMC) and the Drought Code (DC).*

*Low: 0-40 Moderate: 41-80 High: 81-120 Extreme: 121 and above*

```{r, echo=FALSE}
ggplot(hotspots_peak, aes(x = bui)) +
  geom_histogram(binwidth = 10, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of BUI Values", x = "BUI", y = "Frequency") +
  scale_y_continuous(labels = scales::comma) + 
  theme_minimal()

boxplot_bui <- ggplot(hotspots_peak, aes(x = factor(year), y = bui)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "BUI Distribution Across Years",
       x = "Year",
       y = "BUI") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
boxplot_bui
```

*BUI values mostly range from 60 to 150.\
This means the fire potential is moderate to high, with some extreme cases, for most of the dataset.*

```{r, echo=FALSE}
ggplot(monthly_avg, aes(x = month, y = avg_bui, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "BUI by Month",
       x = "Month",
       y = "BUI",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*BUI peaks in mid-summer, which matches the time when fire activity is usually the highest.*

### Remove outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("bui")

# Plot boxplot for BUI
boxplot_bui_clean <- ggplot(hotspots_peak_clean, aes(x = factor(year), y = bui)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "BUI Distribution Across Years (Clean)",
       x = "Year",
       y = "BUI") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
grid.arrange(boxplot_bui, boxplot_bui_clean)
```

*After removing outliers the typical BUI values are between 50 and 150,\
indicating moderate to high fire potential.\
Outliers have been reduced, but 2017 and 2021 still show higher BUI values.*

### Fire Weather Index

*A numeric rating of fire intensity. It is based on the ISI and the BUI,\
and is used as a general index of fire danger throughout the forested areas of Canada.*

*Low (0-5): Minimal fire danger.\
Moderate (6-12): Fires can start from most accidental causes, but the spread is slow.\
High (13-20): Fires can start easily and spread rapidly.\
Very High (21-30): Fires will start very easily, spread rapidly, and burn intensely.\
Extreme (31+): Fires start and spread quickly, and are intense and challenging to control.*

```{r, echo=FALSE}
ggplot(hotspots_peak, aes(x = fwi)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of FWI Values", x = "FWI", y = "Frequency") +
  scale_y_continuous(labels = scales::comma) + 
  theme_minimal()

boxplot_fwi <- ggplot(hotspots_peak, aes(x = factor(year), y = fwi)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "FWI Distribution Across Years",
       x = "Year",
       y = "FWI") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
boxplot_fwi
```

*The histogram shows that most FWI values are between 10 and 40, fire danger is from moderate to extreme.\
Many values are above 30, severe fire weather conditions are frequent.*

*2014 had some extreme outliers.*

```{r, echo=FALSE}
ggplot(monthly_avg, aes(x = month, y = avg_fwi, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "FWI by Month",
       x = "Month",
       y = "FWI",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*The lineplot shows that FWI peaks in mid-summer, peak fire activity period.*

*The FWI is calculated using the Initial Spread Index and the Buildup Index,\
both of which take into account wind speed,\
temperature, humidity, and fuel moisture.\
This is why FWI a reliable indicator of overall fire danger.*

*Fire agencies use the FWI to inform the public, issue fire bans, and respond to fires.\
It helps prioritize resources and actions to mitigate fire risks effectively.*

### Analyses of the extreme outliers of 2014, values greater than 75

```{r}
# Filter out entries with fwi values greater than 75
fwi_outliers <- hotspots_peak %>%
  filter(fwi >= 75)

# Check the number of outliers
fwi_outliers %>% 
  count(event_cluster) %>% 
  arrange(desc(n))
# Most fwi outliers come from clusters 401 and 130, same as isi outliers
```

```{r, fig.width=7, fig.height=11, echo=FALSE}
plot_clusters_on_map(401, hotspots_peak, zoom_level = 10)
plot_clusters_on_map(130, hotspots_peak, zoom_level = 10)
```

*The analysis of FWI extreme outliers in 2014, specifically values greater than 75,\
reveals that these outliers are concentrated in the same event clusters as the ISI outliers\
(clusters 401 and 130).\
This corresponds to the Mount McAllister fire in British Columbia, which occurred in July 2014.*

### Remove outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("fwi")

# Plot boxplot for FWI
boxplot_fwi_clean <- ggplot(hotspots_peak_clean, aes(x = factor(year), y = fwi)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "FWI Distribution Across Years (Clean)",
       x = "Year",
       y = "FWI") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
grid.arrange(boxplot_fwi, boxplot_fwi_clean)
```

*After removing outliers, the FWI boxplots show more consistent distributions across the years.\
Median FWI values generally fall between 20 and 40.*

### Compare indices trends to timeline of fire events

*Create a combined plot from monthly average indices and fire events per month tables\
to show the trends of the ISI, BUI and FWI and the number of fire occurrences over time.*

```{r}
# Use the previously normalized monthly_data table

# Maximum values for scaling
max_isi <- max(monthly_data$avg_isi, na.rm = TRUE)
max_bui <- max(monthly_data$avg_bui, na.rm = TRUE)
max_fwi <- max(monthly_data$avg_fwi, na.rm = TRUE)
```

```{r, echo=FALSE}
# Plot ISI and Fire Counts
ggplot(monthly_data, aes(x = Date)) +
  geom_line(aes(y = avg_isi, color = "ISI"), size = 1) +
  geom_bar(aes(y = norm_n_events * max_isi, fill = "Fire Occurrences"), stat = "identity", color = "black", alpha = 0.6) +
  scale_y_continuous(
    name = "ISI",
    sec.axis = sec_axis(~ . * 1000 / max_isi * max(monthly_data$n_events) / 1000, 
                        name = "Number of Fire Occurrences", labels = comma)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = "Monthly Trends of ISI and Fire Occurrences",
       x = "Year",
       color = "Index",
       fill = "Index") +
  scale_color_manual(values = c("ISI" = "skyblue")) +
  scale_fill_manual(values = c("Fire Occurrences" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")

# Plot BUI and Fire Counts
ggplot(monthly_data, aes(x = Date)) +
  geom_line(aes(y = avg_bui, color = "BUI"), size = 1) +
  geom_bar(aes(y = norm_n_events * max_bui, fill = "Fire Occurrences"), stat = "identity", color = "black", alpha = 0.6) +
  scale_y_continuous(
    name = "BUI",
    sec.axis = sec_axis(~ . * 1000 / max_bui * max(monthly_data$n_events) / 1000, 
                        name = "Number of Fire Occurrences", labels = comma)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = "Monthly Trends of BUI and Fire Occurrences",
       x = "Year",
       color = "Index",
       fill = "Index") +
  scale_color_manual(values = c("BUI" = "skyblue")) +
  scale_fill_manual(values = c("Fire Occurrences" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")

# Plot FWI and Fire Counts
ggplot(monthly_data, aes(x = Date)) +
  geom_line(aes(y = avg_fwi, color = "FWI"), size = 1) +
  geom_bar(aes(y = norm_n_events * max_fwi, fill = "Fire Occurrences"), stat = "identity", color = "black", alpha = 0.6) +
  scale_y_continuous(
    name = "FWI",
    sec.axis = sec_axis(~ . * 1000 / max_fwi * max(monthly_data$n_events) / 1000, 
                        name = "Number of Fire Occurrences", labels = comma)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = "Monthly Trends of FWI and Fire Occurrences",
       x = "Year",
       color = "Index",
       fill = "Index") +
  scale_color_manual(values = c("FWI" = "skyblue")) +
  scale_fill_manual(values = c("Fire Occurrences" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*The plots show a clear link between indices and the number of fires.\
When there are more fires, the FWI is also higher.*

*It's important to remember that while high FWI values mean conditions are good for fires,\
they don't indicate fire presence.*

*Also, while the FWI helps predict how severe fires might be,\
it can't tell us exactly how many fires will happen in a season.\
For example, the FWI was lower in 2018 than in 2017, but 2018 still had some major fires.\
This shows that indices can indicate fire conditions but don't predict the exact number of fires.*

### Other Variables

*These variables include additional factors that can influence fire events, such as fuel type and rate of spread.*

*`fuel`: Fuel Type\
`ros`: Rate of Spread\
`hfi`: Head Fire Intensity*

### Fuel Type

*D1: Deciduous trees (leafless, early spring to fall)\
C2, C3, C4, C5, C7: Various types of coniferous trees\
O1, O1a, O1b: Grass or herbaceous vegetation\
M1, M1M2, M2, M2_25, M2_35, M2_50, M2_65: Mixedwood or transitional vegetation\
bog: Wetland areas with peatland vegetation\
water: Water bodies\
urban: Urban areas\
non_fuel: Areas with no significant vegetation (rock, gravel)\
low_veg: Areas with low vegetation (possibly recently burned or cleared)\
farm: Agricultural areas\
D2: Deadfall or downed wood*

```{r, echo=FALSE}
# Group by fuel and summarize
fuel_counts <- hotspots_peak %>%
  group_by(fuel) %>%
  summarise(count = n()) %>%
  arrange(desc(count))

# Create a bar plot for the fuel column
ggplot(fuel_counts, aes(x = reorder(fuel, -count), y = count)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of Fuel Types", x = "Fuel Type", y = "Count") +
  theme_minimal() +
  scale_y_continuous(labels = scales::comma) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

```{r}
# Summary of other variables
summary_other_variables <- describe_numerical(hotspots_peak, c('ros', 'hfi'))
print(summary_other_variables)
```

### Rate of Spread

*The predicted speed of the fire at the front or head of the fire (where the fire moves fastest).\
It is measured in metres per minute and is based on the Fuel Type, Initial Spread Index, Buildup Index, and some others.\
The scale ranges from 0 to over 20 m/min in the dataset.*

```{r, echo=FALSE}
ggplot(hotspots_peak, aes(x = ros)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution Rate of Spread at Fire Hotspots",
       x = "ROS (m/min)",
       y = "Frequency") +
  scale_y_continuous(labels = comma) + 
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))


ggplot(hotspots_peak, aes(x = factor(year), y = ros)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Rate of Spread Distribution Across Years",
       x = "Year",
       y = "ROS (m/min)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

*The plot shows that the ROS can vary significantly year to year, with some years experiencing more extreme fire spread conditions.*

### Remove outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("ros")

# Plot boxplot for ROS
ggplot(hotspots_peak_clean, aes(x = factor(year), y = ros)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "ROS Distribution Across Years",
       x = "Year",
       y = "ROS") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

*The median ROS values now range between 3 and 10 m/min. Extreme values above 25 m/min have been significantly reduced.*

### Head Fire Intencity

*Measures the intensity or energy output of a fire at its front (head).\
HFI is measured in kilowatts per metre (kW/m) of the fire front and is calculated based on the Rate of Spread (ROS) and the Total Fuel Consumption (TFC).*

*Low (0-500 kW/m): Fires are relatively easy to control and generally cause limited damage.\
Moderate (500-2000 kW/m): Fires can be challenging to control, requiring more resources and effort.\
High (2000-4000 kW/m): Fires are intense and difficult to manage, often requiring aerial firefighting resources.\
Very High (4000-10,000 kW/m): Fires are extremely intense and nearly impossible to control, posing significant risk to life and property.\
Extreme (10,000+ kW/m): Fires exhibit explosive behavior and can cause catastrophic damage.*

*Helps predict fire destructiveness, allocate resources, warn or evacuate public.*

```{r, echo=FALSE}
# Plot histogram for HFI
ggplot(hotspots_peak, aes(x = hfi)) +
  geom_histogram(binwidth = 1000, fill = "skyblue", color = "black", alpha = 0.7) + # Each bin represent a range of 1000 HFI units.
  labs(title = "Distribution of HFI Values",
       x = "HFI (kW/m)",
       y = "Frequency") +
  scale_y_continuous(labels = scales::comma) + 
  scale_x_continuous(breaks = seq(0, 75000, 10000)) +
  theme_minimal()

ggplot(hotspots_peak, aes(x = factor(year), y = hfi)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "HFI Distribution Across Years",
       x = "Year",
       y = "HFI (kW/m)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

*Most HFI values are concentrated at the lower end of the scale.\
Very high HFI values are outliers they show occasional extremely intense fires.\
While most fires are less intense, the few high-intensity fires can be significant and impactful.*

*Boxplots show significant outliers in almost all years, there are some fires with extremely high intensities.*

```{r, echo=FALSE}
ggplot(monthly_avg, aes(x = month, y = avg_hfi, color = factor(year), group = year)) +
  geom_line(size = 0.5, alpha = 0.6, linetype = "dotted") +  # raw data
  geom_smooth(se = FALSE, method = "loess", size = 1, linetype = "solid") +  # Smoothed trend line
  labs(title = "HFI by Month",
       x = "Month",
       y = "HFI (kW/m)",
       color = "Year") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*Different years show a lot of differences in HFI values.\
For example, 2014 and 2021 had higher peaks, meaning there was more intense fire activity in those years.\
2020 had lower HFI values, there were milder fire conditions or better fire control efforts.*

*The plots also show how HFI can change from month to month within a single fire season.\
Weather conditions, temperature, humidity, and wind speed, can affect how fires behave.*

### Compare HFI to the number of fire events.

```{r}
# Use the previously normalized monthly_data table

# Maximum values for scaling
max_hfi <- max(monthly_data$avg_hfi, na.rm = TRUE)
```

```{r, echo=FALSE}
# Plot HFI and Fire Counts
ggplot(monthly_data, aes(x = Date)) +
  geom_line(aes(y = avg_hfi, color = "HFI"), size = 1) +
  geom_bar(aes(y = norm_n_events * max_hfi, fill = "Fire Occurrences"), stat = "identity", color = "black", alpha = 0.6) +
  scale_y_continuous(
    name = "HFI",
    sec.axis = sec_axis(~ . * 1000 / max_hfi * max(monthly_data$n_events) / 1000, 
                        name = "Number of Fire Occurrences", labels = comma)) +
  scale_x_date(date_labels = "%Y", date_breaks = "1 year") +
  labs(title = "Monthly Trends of HFI and Fire Occurrences",
       x = "Year",
       color = "Index",
       fill = "Index") +
  scale_color_manual(values = c("HFI" = "lightblue")) +
  scale_fill_manual(values = c("Fire Occurrences" = "red")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "bottom")
```

*The HFI index shows notable peaks, particularly in the years 2017, 2018, 2021 and 2023.*

### Analyses of the extreme outliers of 2014, 2018, 2021 and 2023, values greater than 75000

```{r}
# Filter out entries with HFI values greater than 75000
hfi_outliers <- hotspots_peak %>%
  filter(hfi >= 75000)

# Check the number of outliers
hfi_outliers %>% 
  count(event_cluster) %>% 
  arrange(desc(n))
# Most hfi outliers come from clusters 4956, 4844, 13837 and 4887

```

```{r}
# See the details of the events with high hfi
cluster_summary %>%
  filter(event_cluster %in% c(4956, 4844, 13837, 4887))
```

*Snowy Mountain Fire and other fires in the Okanagan region in 2018.\
Placer Mountain Fire area, a notable fire from 2018, which also burned in 2023.*

```{r, fig.width=7, fig.height=11, echo=FALSE}
plot_clusters_on_map(4956, hotspots_peak, zoom_level = 10) 

plot_clusters_on_map(4844, hotspots_peak, zoom_level = 10) 

plot_clusters_on_map(4887, hotspots_peak, zoom_level = 10)

plot_clusters_on_map(13837, hotspots_peak, zoom_level = 10)
```

### Remove the outliers

```{r, echo=FALSE}
# Remove outliers
hotspots_peak_clean <- hotspots_peak %>%
  remove_outliers("hfi")

# Plot boxplot for HFI
ggplot(hotspots_peak_clean, aes(x = factor(year), y = hfi)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "HFI Distribution Across Years",
       x = "Year",
       y = "HFI") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
        axis.text.y = element_text(size = 10))
```

*The median HFI values are generally below 20,000 kW/m after removing outliers.*




## Tests and Models

*In this section, we use statistical tests to see some meaningful patters and build models to predict fire risk.*

*Subset the hotspots dataset to focus on specific numerical variables.*

```{r}
# Define the numeric columns
numeric_columns <- c("temp", "rh", "ws", "pcp", "ffmc", "dmc", "dc", "isi", "bui", "fwi", "ros", "hfi")

# Subset the dataframe
hotspots_test <- hotspots_peak_clean %>%
  select(all_of(numeric_columns), year, month, rep_date, event_cluster)

str(hotspots_test)
```

```{r}

# List of fire indices to summarize
fire_indices <- c('ffmc', 'dmc', 'dc', 'isi', 'bui', 'fwi')

# Apply the describe_numerical function to the fire indices in the hotspots_test dataset
summary_fire_indices <- describe_numerical(hotspots_test, fire_indices)

# Print the summary statistics for the fire indices
print(summary_fire_indices)
```

*During EDA we looked into distributions of six key Fire Indices across different years.*

*The distributions of these indices for a particular year, 2018,*

*appeared to be close to the overall average values of these indices.*

*We also found out that 2018 had some significant fire events.*

```{r}
# Average number of observations per year
nrow(hotspots_peak) / length(unique(hotspots_peak$year))

# Average number of unique event_clusters per year
length(unique(hotspots_peak$event_cluster)) / length(unique(hotspots_peak$year))

# Number of observations in 2018
nrow(filter(hotspots_peak_clean, year == 2018))

# Number of unique event clusters in 2018
length(unique(filter(hotspots_peak_clean, year == 2018)$event_cluster))
```

*From these calculations, we found that 2018 had a significantly higher number of observations and event clusters compared to the average over the ten-year period.*


```{r, fig.width=10, fig.height=11, echo=FALSE}
grid.arrange(boxplot_ffmc_clean, boxplot_dmc_clean, boxplot_dc_clean,
             boxplot_isi_clean, boxplot_bui_clean, boxplot_fwi_clean, nrow = 3, ncol = 2)
```


*Despite the higher number of fire events, the main indices (FFMC, DMC, DC, ISI, BUI, FWI) remained close to their median values across the dataset.*

*Therefore we wanted to test if the increased number of fires in 2018 was due to random chance or if other factors were at play.*

*We need to perform statistical tests to compare the indices for 2018 against the overall dataset.*

*A p-value greater than 0.05 would suggest that the higher number of fires could be due to a chance,\
and a lower p-value would mean the presence of other contributing factors.*




*Summary statistics for before T Test*


```{r}
# Summary statistics for the overall dataset
summary_overall <- describe_numerical(hotspots_peak, fire_indices)
summary_overall
```

```{r}
# Filter data for the year 2018
hotspots_test_2018 <- hotspots_test %>% filter(year == 2018)

# Summary statistics for the year 2018
summary_2018 <- describe_numerical(hotspots_test_2018, fire_indices)
summary_2018
```




*Check the histograms if they follow the normal distribution.*

```{r, fig.width=10, fig.height=11, echo=FALSE}

# FFMC Histogram in 2018 with Normal Curve
norm_d_ffmc <- ggplot(hotspots_test_2018, aes(x = ffmc)) +
  geom_histogram(aes(y = ..density..), binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(hotspots_test_2018$ffmc, na.rm = TRUE), 
                                         sd = sd(hotspots_test_2018$ffmc, na.rm = TRUE)), 
                color = "red", linewidth = 1) +
  labs(title = "FFMC Histogram in 2018 with Normal Curve",
       x = "FFMC",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))



# DMC Histogram in 2018 with Normal Curve
norm_d_dmc <- ggplot(hotspots_test_2018, aes(x = dmc)) +
  geom_histogram(aes(y = ..density..), binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(hotspots_test_2018$dmc, na.rm = TRUE), 
                                         sd = sd(hotspots_test_2018$dmc, na.rm = TRUE)), 
                color = "red", linewidth = 1) +
  labs(title = "DMC Histogram in 2018 with Normal Curve",
       x = "DMC",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))



# DC Histogram in 2018 with Normal Curve
norm_d_dc <- ggplot(hotspots_test_2018, aes(x = dc)) +
  geom_histogram(aes(y = ..density..), binwidth = 50, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(hotspots_test_2018$dc, na.rm = TRUE), 
                                         sd = sd(hotspots_test_2018$dc, na.rm = TRUE)), 
                color = "red", linewidth = 1) +
  labs(title = "DC Histogram in 2018 with Normal Curve",
       x = "DC",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))



# ISI Histogram in 2018 with Normal Curve
norm_d_isi <- ggplot(hotspots_test_2018, aes(x = isi)) +
  geom_histogram(aes(y = ..density..), binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(hotspots_test_2018$isi, na.rm = TRUE), 
                                         sd = sd(hotspots_test_2018$isi, na.rm = TRUE)), 
                color = "red", linewidth = 1) +
  labs(title = "ISI Histogram in 2018 with Normal Curve",
       x = "ISI",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))


# BUI Histogram in 2018 with Normal Curve
norm_d_bui <- ggplot(hotspots_test_2018, aes(x = bui)) +
  geom_histogram(aes(y = ..density..), binwidth = 10, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(hotspots_test_2018$bui, na.rm = TRUE), 
                                         sd = sd(hotspots_test_2018$bui, na.rm = TRUE)), 
                color = "red", linewidth = 1) +
  labs(title = "BUI Histogram in 2018 with Normal Curve",
       x = "BUI",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))


# FWI Histogram in 2018 with Normal Curve
norm_d_fwi <- ggplot(hotspots_test_2018, aes(x = fwi)) +
  geom_histogram(aes(y = ..density..), binwidth = 5, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(hotspots_test_2018$fwi, na.rm = TRUE), 
                                         sd = sd(hotspots_test_2018$fwi, na.rm = TRUE)), 
                color = "red", linewidth = 1) +
  labs(title = "FWI Histogram in 2018 with Normal Curve",
       x = "FWI",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))


grid.arrange(norm_d_ffmc, norm_d_dmc, norm_d_dc, norm_d_isi, norm_d_bui, norm_d_fwi, nrow = 3, ncol = 2)
# Most indices appear to be not normally distributed

```


```{r, echo=FALSE}
# Differences
difference <- summary_2018$Median - summary_overall$Median

# Percentage difference
percentage_difference <- (summary_2018$Median - summary_overall$Median) / summary_overall$Median * 100

# Create summary table
test_summary <- data.frame(
  Index = summary_overall$Variable,
  Overall_Median = summary_overall$Median,
  Year_2018_Median = summary_2018$Median,
  Difference = round(difference, 2),
  Percentage_Difference = round(percentage_difference, 2)

)

# Print the summary table
print(test_summary)
```



```{r, echo=FALSE}
# Function to format p-values
format_p_value <- function(p) {
  if (p < 1e-6) {
    return("<0.000001")
  } else {
    return(format(round(p, 6), nsmall = 6))
  }
}

# Function to create the summary table
create_summary_table <- function(test_results) {
  test_summary <- data.frame(
    Index = fire_indices,
    Overall_Mean = round(summary_overall$Mean, 2),
    Year_2018_Mean = round(summary_2018$Mean, 2),
    Mean_Difference = round(summary_overall$Mean - summary_2018$Mean, 2),
    P_Value = sapply(test_results, function(x) format_p_value(x$p.value)),
    Significant = sapply(test_results, function(x) ifelse(x$p.value < 0.05, "Yes", "No"))
  )
  
  return(test_summary)
}

```



#### Wilcoxon test

*During our normality checks, some of the variables did not show a smooth bell curve, meaning that they do not follow a normal distribution. We decided to perform nonparametric tests, which do not assume a normal distribution of the data, to compare the results.*

```{r}
# Perform Wilcoxon tests
test_results_wilcoxon <- lapply(fire_indices, function(index) {
  wilcox.test(hotspots_peak_clean[[index]], hotspots_test_2018[[index]])
})
test_results_wilcoxon
```

```{r}
# Print summary table for Wilcoxon test
summary_table_wilcoxon <- create_summary_table(test_results_wilcoxon)
print(summary_table_wilcoxon)
```

*All six fire indices show significant differences between the values in 2018 and the overall values across all years.*

*This suggests that the conditions in 2018 were statistically different from the overall conditions in the dataset.*

*There were likely specific factors in 2018 that contributed to these differences.*

*While the t-tests show that there are significant differences in the fire indices, they don't prove that higher values of these indices cause more fires.*

*However, the higher values of indices like FWI, DMC, and others in 2018 suggest there is a link, meaning higher values of these indices likely mean conditions for more fires.*

*To find the relationship between these indices and the number of fires, need to make more analysis, like regression modeling.*



#### Analysis of Two Similar Clusters

*Further we wanted to test similar clusters.*

*We need to find two clusters of fire events with similar characteristics, mean indices, perform statistical tests to compare their indices, and visualize the results.*

*We selected clusters based on the similarity of their mean Fire Weather Index (FWI) and Drought Code (DC).*

```{r}
# Calculate summary statistics for each cluster
cluster_summary_indices <- hotspots_test %>%
  group_by(event_cluster) %>%
  summarise(
    num_events = n(),          
    mean_fwi = mean(fwi),  # Mean FWI value for each cluster
    mean_dc = mean(dc)     # Mean DC value for each cluster
  )

# Filter clusters that have 1000+ events
chosen_clusters <- cluster_summary_indices %>%
  filter(num_events >= 1000 & num_events <= 6000)

# Function to calculate how similar mean values are
calculate_similar <- function(df) {
  df %>%
    mutate(
      fwi_diff = abs(mean_fwi - mean(chosen_clusters$mean_fwi)),
      dc_diff = abs(mean_dc - mean(chosen_clusters$mean_dc)),
      similar = fwi_diff + dc_diff
    ) %>%
    arrange(similar)
}

# Apply the function and choose two clusters with the closest mean FWI and DC
chosen_clusters <- chosen_clusters %>%
  calculate_similar() %>%
  slice(1:2)

# Chosen clusters
print(chosen_clusters)

```

```{r}
# Chosen cluster IDs
chosen_ids <- chosen_clusters$event_cluster

# Summary table for the chosen clusters
cluster_summary <- hotspots_test %>%
  filter(event_cluster %in% chosen_ids) %>%
  group_by(event_cluster, year, month) %>%
  summarize(
    count = n(),
    mean_ffmc = mean(ffmc, na.rm = TRUE),
    mean_dmc = mean(dmc, na.rm = TRUE),
    mean_dc = mean(dc, na.rm = TRUE),
    mean_isi = mean(isi, na.rm = TRUE),
    mean_bui = mean(bui, na.rm = TRUE),
    mean_fwi = mean(fwi, na.rm = TRUE)
  )
print(cluster_summary)

```

*Plot the clusters on the map*

```{r, fig.width=7, fig.height=11, echo=FALSE}
# Plot the chosen clusters on the map
plot_clusters_on_map(chosen_ids, hotspots_peak, zoom_level = 10)
```

*Subset the dataframe for the chosen clusters*

```{r}
# Filter data for the two chosen clusters
cluster_1 <- hotspots_test %>% filter(event_cluster == chosen_ids[1])
cluster_2 <- hotspots_test %>% filter(event_cluster == chosen_ids[2])
```

*Visualize the distribution*

```{r, echo=FALSE}
# Plot histograms for DC

# DC Histogram for cluster_1
ggplot(cluster_1, aes(x = dc)) +
  geom_histogram(aes(y = ..density..), binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(cluster_1$dc, na.rm = TRUE), 
                                         sd = sd(cluster_1$dc, na.rm = TRUE)), 
                color = "red", size = 1) +
  labs(title = "DC Histogram for Cluster 1",
       x = "DC",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))

# DC Histogram for cluster_2
ggplot(cluster_2, aes(x = dc)) +
  geom_histogram(aes(y = ..density..), binwidth = 1, fill = "skyblue", color = "black", alpha = 0.7) +
  stat_function(fun = dnorm, args = list(mean = mean(cluster_2$dc, na.rm = TRUE), 
                                         sd = sd(cluster_2$dc, na.rm = TRUE)), 
                color = "red", size = 1) +
  labs(title = "DC Histogram for Cluster 2",
       x = "DC",
       y = "Density") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5, size = 15),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        axis.text.x = element_text(size = 10),
        axis.text.y = element_text(size = 10))

```

```{r}
# Perform t-test on DC for the two clusters
t_test_result <- t.test(cluster_1$dc, cluster_2$dc, alternative = "two.sided")

# Print the t-test result
print(t_test_result)

```

*The t-test shows no significant difference in the DC values between the two clusters (cluster_1 and cluster_2).*

*The p-value is greater than 0.05, and the confidence interval suggests that the observed differences could be due to random chance rather than a true difference in means.*

*Therefore, the DC values for these clusters are statistically similar.*






### Linear regression model

Analyze the weekly number of fires using various fire index predictors. The goal is to build a linear regression model to predict the number of fires and see its performance.

```{r}
# Create a week column
hotspots_test$week <- format(hotspots_test$rep_date, "%Y-%U")

# Create weekly summary with event counts (fires) and average weekly indices
weekly_summary <- hotspots_test %>%
  group_by(week) %>%
  summarise(
    fires = n(),
    hfi = mean(hfi, na.rm = TRUE),
    temp = mean(temp, na.rm = TRUE),
    rh = mean(rh, na.rm = TRUE),
    ws = mean(ws, na.rm = TRUE),
    pcp = mean(pcp, na.rm = TRUE),
    ffmc = mean(ffmc, na.rm = TRUE),
    dmc = mean(dmc, na.rm = TRUE),
    dc = mean(dc, na.rm = TRUE),
    isi = mean(isi, na.rm = TRUE),
    bui = mean(bui, na.rm = TRUE),
    fwi = mean(fwi, na.rm = TRUE),
    ros = mean(ros, na.rm = TRUE)
  )
weekly_summary
```

```{r, echo=FALSE}
# Distribution of the number of fires per week
ggplot(weekly_summary, aes(x = fires)) +
  geom_histogram(binwidth = 1000, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of Weekly Number of Fires", 
       x = "Number of Fires", 
       y = "Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  )
```

Transform the number of fires to get more normally distributed data

```{r}
# Best parameter Box-Cox 
boxcox_result <- MASS::boxcox(lm(fires ~ 1, data = weekly_summary))
lm_best <- boxcox_result$x[which.max(boxcox_result$y)]
lm_best

# Transform with lm_best
weekly_summary <- weekly_summary %>%
  mutate(boxcox_fires = ((fires + 1)^lm_best - 1) / lm_best)
```

```{r, echo=FALSE}
# Distribution of Box-Cox transformed number of fires
ggplot(weekly_summary, aes(x = boxcox_fires)) +
  geom_histogram(binwidth = 0.2, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of Box-Cox Transformed Weekly Number of Fires", 
       x = "Box-Cox Transformed Number of Fires", 
       y = "Frequency") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  )


# Boxplot of Box-Cox transformed number of fires
ggplot(weekly_summary, aes(y = boxcox_fires)) +
  geom_boxplot(fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Boxplot of Box-Cox Transformed Weekly Number of Fires", 
       y = "Box-Cox Transformed Number of Fires") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14),
    axis.title = element_text(size = 12),
    axis.text = element_text(size = 10)
  )
```

```{r, echo=FALSE}
# Create scatterplot matrix
ggpairs(weekly_summary, columns = c("fires", "boxcox_fires", numeric_columns),
        title = "Scatterplot Matrix of Predictors")
```

##### 

```{r}
# Model 1
model_1 <- lm(boxcox_fires ~ dmc + dc + bui + fwi + hfi + ffmc + isi, data = weekly_summary)
summary(model_1)

```

```{r}
# Check for multicollinearity
vif(model_1)
```

```{r}
# Remove bui
model_no_bui <- lm(boxcox_fires ~ dmc + dc + fwi + hfi + ffmc + isi, data = weekly_summary)
summary(model_no_bui)
```

```{r}
# Check for multicollinearity
vif(model_no_bui)
```

```{r}
# Remove fwi
model_no_fwi <- lm(boxcox_fires ~ dmc + dc + hfi + ffmc + isi, data = weekly_summary)
summary(model_no_fwi)
```

```{r}
# Check for multicollinearity
vif(model_no_fwi)
```

```{r}
# Remove non-significant predictors
model_final <- lm(boxcox_fires ~ dc + hfi + ffmc, data = weekly_summary)
summary(model_final)
```

```{r}
# Check for multicollinearity
vif(model_final)
```

```{r, echo=FALSE}
# Plot diagnostic plots
par(mfrow = c(2, 2))
plot(model_final)
```

#### Example use of the model

```{r}
# Create a dataframe with hypothetical conditions
test_1 <- data.frame(
  dc = c(200, 300, 400),     # Example values for Drought Code
  hfi = c(1000, 2000, 3000), # Example values for Head Fire Intensity
  ffmc = c(85, 90, 95)       # Example values for Fine Fuel Moisture Code
)
```

```{r}
# Predict the Box-Cox transformed number of fires
predicted_boxcox_fires_test_1 <- predict(model_final, newdata = test_1)

# Reverse Box-Cox transformation
reverse_boxcox <- function(y, lambda) {
  if (lambda == 0) {
    exp(y) - 1
  } else {
    ((y * lambda) + 1)^(1 / lambda) - 1
  }
}

# Transform to original scale
predicted_fires_test_1 <- reverse_boxcox(predicted_boxcox_fires_test_1, lm_best)

```

```{r}
# Model predictions
result_test_1 <- cbind(test_1, predicted_fires_test_1)
print(result_test_1)
```

```{r}
# Create a dataframe with hypothetical conditions (only HFI changes)
test_2 <- data.frame(
  dc = rep(300, 5),                # Constant value for Drought Code
  hfi = seq(1000, 5000, by = 1000),# Varying values for Head Fire Intensity
  ffmc = rep(90, 5)                # Constant value for Fine Fuel Moisture Code
)
```

```{r}
# Predict the Box-Cox transformed number of fires
predicted_boxcox_fires_test_2 <- predict(model_final, newdata = test_2)

# Transform to original scale
predicted_fires_test_2 <- reverse_boxcox(predicted_boxcox_fires_test_2, lm_best)
```

```{r}
# Model predictions
result_test_2 <- cbind(test_2, predicted_fires_test_2)
print(result_test_2)
```
